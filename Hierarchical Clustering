#------------------Question 2-----------------------Question 2---------------------

rm(list=ls())
#Set the working directory
setwd("C:/Users/Aditya Murali/Desktop")

#Read data from file
mydata <- read.csv("Pharmaceuticals.csv", header = TRUE)

#Replace index of data set with company symbol
row.names(mydata) <- mydata[,1]

#Drop the non numeric columns
mydata <- mydata[,-c(1:2,12:14)]

#Normalize the data as variables represent different units and scales
mydata.norm <- sapply(mydata, scale)

#Set row names of original data for normalised data 
row.names(mydata.norm) <- row.names(mydata)

#Call NbClust Library
library(NbClust)

#Set the seed
set.seed(42)

#Use NbClust package to find optimum number of clusters
nc <- NbClust(mydata.norm, distance="euclidean", min.nc=2, max.nc=10, method="average")
table(nc$Best.n[1,])
barplot(table(nc$Best.n[1,]), xlab="Number of Clusters", ylab="Number of criteria", main="Number of clusters chosen by criteria")

#Create the dendogram
d <- dist(mydata.norm)
fit.average <- hclust(d, method="average")
plot(fit.average, hang = -1, cex=0.8, main="average linkage clustering")

#Cut the dendogram at the required level to get corresponding cluster size
clusters <- cutree(fit.average, k=3)
table(clusters)
aggregate(mydata.norm, by=list(cluster=clusters), median)
rect.hclust(fit.average, k=3)

#Try another type of clustering: K Means
#Set seed value = 42
set.seed(42)
#How many clusters are chosen by criteria of NbClust package
nc <- NbClust(mydata, min.nc=2, max.nc=10, method="kmeans")
table(nc$Best.n[1,])
barplot(table(nc$Best.n[1,]), xlab="Number of Clusters", ylab="Number of criteria", main="Number of clusters chosen by criteria")

#Set seed value = 42
set.seed(42)
# Perform k-means cluster analysis for k = 3 as it is the optimal cluster size
fit.km <- kmeans(mydata.norm, 3, nstart=25)
# Calculate number of observations in each cluster
fit.km$size
# calcualte cluster centroids
fit.km$centers
